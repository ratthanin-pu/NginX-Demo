Slide
# แสดง infra. สำหรับ Demo 
# แสดงรายละเอีิยด จำนวน host,vm,spec & Diagram 

Demo or clip #00
# login เข้า VDI 
# เปิด command line แสดงชื่อ Host & IP
# เปิด Chrome เข้า vCenter server web : https://192.168.151.100
# login เข้า vCenter
# แสดง จำนวน host & VM และ spec ของ Openshift VM ทั้งหมด ผ่าน vCenter wev console & remote host IP

Demo or clip #01
# remote Desktop ไปที่ server IP : 192.168.151.189
# u:addmin-01
# p:adm#1234
# เปิด command line แสดงชื่อ Host & IP

# connect ไปที่ console ของ openshift ด้วย command
oc login -a demo01 -u demo01 https://api.ocpcluster.gabledemo.com:6443

oc get pod

# login เข้าไปที่ openshift cluster ผ่าน browser chromium 
# https://console-openshift-console.apps.ocpcluster.gabledemo.com
# u:demo01
# p:demo01

#แสดง NginX Ingress Operator ใน Openshift Operator Console




#login OpenShift ผ่าน command

oc login -u opsadm -p adm1234 https://api.ocpcluster.gabledemo.com:6443
oc get node
oc project nginx-ingress
oc get pod


oc login -u demo01 -p demo01 https://api.ocpcluster.gabledemo.com:6443
oc project
oc get pod

#แสดง command oc get pod -n <nginx-xxxx>

#Show Code ใน GitHub -> push code ขึ้น GitHub new Repo
#Show YAML file for deploy virtual server by CRD

#Deploy web dot blue
oc apply -f https://raw.githubusercontent.com/ratthanin-pu/NginX-Demo/main/BlueGreen-demo/bullet-web/01-Blue-Web-Deployment.yaml

เปิด yaml สำหรับ VirtualServer

#Deploy VirtualServer
oc apply -f https://raw.githubusercontent.com/ratthanin-pu/NginX-Demo/main/BlueGreen-demo/01-bg-blue-vs.yaml


# Open chrome to access web dot blue via VirtualServer
go to web http://dot.demo.ocpcluster.gabledemo.com/
must show blue bullet web
*default is blue

#################################################
Use Case #1 Test a New Version in Production by Debug routing
#Deploy web dot green

oc apply -f https://raw.githubusercontent.com/ratthanin-pu/NginX-Demo/main/BlueGreen-demo/bullet-web/02-Green-Web-Deployment.yaml

#Deploy web dot red

oc apply -f https://raw.githubusercontent.com/ratthanin-pu/NginX-Demo/main/BlueGreen-demo/bullet-web/03-Red-Web-Deployment.yaml

#Remove VS
oc delete -f https://raw.githubusercontent.com/ratthanin-pu/NginX-Demo/main/BlueGreen-demo/01-bg-blue-vs.yaml

#Deploy VirtualServer for Debug routing
oc apply -f https://raw.githubusercontent.com/ratthanin-pu/NginX-Demo/main/BlueGreen-demo/02-1-bg-condition-header-vs.yaml

#goto chrome browser 
- clear cache
- set header request value to "version" value = green
- reload web http://dot.demo.ocpcluster.gabledemo.com/
must show green with header parameter

########################################################
Use Case #2 Ensure a New Version is Stable by Canary deployment

#Remove VS
oc delete -f https://raw.githubusercontent.com/ratthanin-pu/NginX-Demo/main/BlueGreen-demo/02-1-bg-condition-header-vs.yaml

#Deploy VirtualServer for Cannary deployment
oc apply -f https://raw.githubusercontent.com/ratthanin-pu/NginX-Demo/main/BlueGreen-demo/03-1-cannary-deployment.yaml

Testing : goto chrome browser 
- remove header request parameter
- clear cache
- reload web http://dot.demo.ocpcluster.gabledemo.com/
* must show mix with blue 80% & green 20% 
- adjust in OCP console virtugl server yaml: blue 30% & green 70%  
- clear cache
- reload web http://dot.demo.ocpcluster.gabledemo.com/

########################################################
Use Case #2.1 Target group for Canary deployment

solution : Canary Deployment with condition 

#Remove VS
oc delete -f https://raw.githubusercontent.com/ratthanin-pu/NginX-Demo/main/BlueGreen-demo/03-1-cannary-deployment.yaml

#Deploy VirtualServer for Cannary deployment
oc apply -f https://raw.githubusercontent.com/ratthanin-pu/NginX-Demo/main/BlueGreen-demo/03-2-cannary-split-condition-header-vs.yaml

Testing : goto chrome browser 
- remove header request parameter
- clear cache
- reload web http://dot.demo.ocpcluster.gabledemo.com/
* must show blue dot is default
- add header parameter "user" "testgroup"
- adjust in OCP console virtugl server yaml: chage blue to red
- clear cache
- reload web http://dot.demo.ocpcluster.gabledemo.com/










